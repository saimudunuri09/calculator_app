stage('Deploy') {
    steps {
        script {
            echo "Deploying to ${ENVIRONMENT}"

            // Map environment to port + container name
            def PORT = ""
            def CONTAINER_NAME = ""

            if (ENVIRONMENT == "dev1") {
                PORT = "5001"
                CONTAINER_NAME = "calculator-dev1"
            }
            else if (ENVIRONMENT == "dev2") {
                PORT = "5002"
                CONTAINER_NAME = "calculator-dev2"
            }
            else if (ENVIRONMENT == "dev3") {
                PORT = "5003"
                CONTAINER_NAME = "calculator-dev3"
            }
            else {
                error "Invalid environment selected!"
            }

            sh """
                docker stop ${CONTAINER_NAME} || true
                docker rm ${CONTAINER_NAME} || true
                docker run -d -p ${PORT}:5000 --name ${CONTAINER_NAME} calculator-app
            """

            echo "========================================="
            echo " ðŸš€ DEPLOYMENT SUCCESSFUL"
            echo "========================================="
            echo "Environment     : ${ENVIRONMENT}"
            echo "App Running At  : http://localhost:${PORT}"
            echo "========================================="
        }
    }
}
